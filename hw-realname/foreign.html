<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./css/style.css">
</head>
<body>
    <div class="layout-stick">
        <div class="layout-stick-main">
            <div class="wrap">
                <div class="top">
                    <div class="main">
                        <img src="images/logo2.jpg" alt="4399安全中心"/>
                        <span>港澳台/境外用户认证</span>
                    </div>
                </div>
            </div>
            <div class="main fixed oversea clearfix">
                <div class="oversea-writen" style="display: none;">
                    <div class="invalid-feedback global-invalid-feedback" style="display: none;"></div>
                    <div class="u-tab">
                        <ul class="tab-hd">
                            <li class="cur"><span>护照验证</span></li>
                            <li><span>台胞证验证</span></li>
                            <li><span>回乡证验证</span></li>
                        </ul>
                        <div class="tab-bd">
                            <div class="tab-cont" style="display: block;">
                                <form class="u-form" name="a" action="">
                                    <div class="invalid-feedback"></div>
                                    <div class="oversea-section">
                                        <div class="section-tit">填写个人信息</div>
                                        <div class="form-group form-group-horizen">
                                            <label class="form-label" for="">姓       名</label>
                                            <input class="form-control" type="text" value="请输入你的姓名" name="name" data-placeholder="请输入你的姓名" onblur="onBlur(this);" onfocus="onFocus(this);" >
                                            <div class="form-tips">示例：张三</div>
                                        </div>
                                        <div class="form-group form-group-horizen">
                                            <label class="form-label" for="">证件号码</label>
                                            <input class="form-control" type="text" value="请输入护照号码" name="idcard" data-placeholder="请输入护照号码" onblur="onBlur(this);" onfocus="onFocus(this);">
                                            <div class="form-tips">示例：E00000000</div>
                                        </div>
                                    </div>
                                    <div class="oversea-section">
                                        <div class="section-tit">上传护照照片</div>
                                        <div class="section-txt">
                                            <p>1、证件将会进行人审核，请上传真实的证件照片，否则将不予通过审核</p>
                                            <p>2、只支持上传JPG/JPEG/PNG文件</p>
                                        </div>
                                        <div class="oversea-file">
                                            <div class="file-field">
                                                <input class="" type="file" id="fileField1" name="attach" size="25"/>
                                                <img class="file-img" src="" alt="">
                                                <div class="file-layer file-layer-reupload"><i></i><p>重新上传</p></div>
                                                <div class="file-layer file-layer-error"><p class="error-txt">文件格式错误</p><p>重新上传</p></div>                       
                                            </div>
                                            <p class="file-txt">请上传台胞证正面照片</p>
                                        </div>
                                        <div class="oversea-example">
                                            <img src="./images/oversea_1.jpg" alt="">
                                            <p class="example-txt">示例</p>
                                        </div>
                                    </div>
                                    <div class="form-group-btn">
                                        <button type="button" class="btn btn-primary j-submit">提交审核</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="u-tip">
                        <p><b>隐私申明</b></p>
                        <p>用户填写的身份信息属于用户个人隐私，4399公司严格保护用户个人信息，不公开、 编辑或透露用户信息</p>
                    </div>
                    <div id="j-confirm-temp" style="display: none;">
                        <div class="u-dialog">
                            <div class="dialog-tit">提交成功</div>
                            <div class="dialog-txt"></div>
                            <div class="dialog-btns">
                                <a href="javascript:;" class="btn btn-primary j-confirm">我知道了</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="oversea-status oversea-success" style="display: none;">
                    <div class="status-icon"></div>
                    <div class="status-tit">认证成功</div>
                    <div class="status-txt">
                        <p>您已认证，基于隐私保护，已隐藏认证信息</p>
                        <p>返回原来的页面即可继续相关操作</p>
                    </div>
                </div>
                <div class="oversea-status oversea-wait" style="display: none;">
                    <div class="status-icon"></div>
                    <div class="status-tit">正在审核中</div>
                    <div class="status-txt">
                        <p>您已认证，基于隐私保护，已隐藏认证信息</p>
                        <p>返回原来的页面即可继续相关操作</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="footer">
        <div style="width: 960px; margin: auto">
            <div class="copyright">
                <a href="http://www.beian.miit.gov.cn/" rel="nofollow" target="_blank">ICP证：闽B2-20040099</a>&nbsp;<a target="_blank"  href="http://sq.ccm.gov.cn/ccnt/sczr/service/business/emark/toDetail/9F5113E34F5E4443A68F11E8A6E2685C">闽网文[2018]9590-427号</a> <a href="http://www.4399.com/zs/chuban.html" target="_blank">新出网证(闽)字06号</a> 法律顾问：北京盛峰律师事务所<br>
                健康游戏忠告：抵制不良游戏 拒绝盗版游戏 注意自我保护 谨防受骗上当 适度游戏益脑 沉迷游戏伤身 合理安排时间 享受健康生活<br>
                文明办网文明上网举报电话：400-655-4399转130 举报邮箱：jubao@4399.com <a href="http://web.4399.com/jiazhang/" target="_blank">未成年人家长监护</a> 四三九九网络股份有限公司<br>
                Copyright © 2004-2020
            </div>
        </div>
    </div>
    <script type="text/javascript" src="./js/jquery-1.4.4.min.js"></script>
    <script type="text/javascript" src="./js/ajaxfileupload.js"></script>
    <script type="text/javascript" src="./js/ks.dialog.js"></script>
    <script type="text/javascript">
        function onBlur(ele) {
            var $ele = $(ele);
            if($ele.val() === ""){
                $ele.val($ele.attr("data-placeholder"));
                $ele.css("color","#aaaaaa");
                return false;
            }
        };
        function onFocus(ele) {
            var $ele = $(ele);
            $ele.css("color","#000");
            if($ele.val() === $ele.attr("data-placeholder")){
                $ele.val("");
            }
        }
        function imageFormatCheck(ele) {
            return /.(jpg|png|gif|bmp)$/.test(ele.value) ? true : false 
        }
        function getIdcardState() {
            //$.getJSON('/ptlogin/getIdcardState.do', function(res) {
                var res = {
                    code : 300,
                    result : {
                        foreign_idcard_state : 2
                    }
                }
                if (res.code == 300) {
                    if(res.result.foreign_idcard_state){
                        if(res.result.foreign_idcard_state == 1 || res.result.foreign_idcard_state == 4){   //待审核
                            $(".oversea-wait").show();
                        }else if(res.result.foreign_idcard_state == 2){ //审核失败
                            $(".oversea-writen").show();
                            $(".global-invalid-feedback").html("您上次身份认证未通过，请填写真实的身份信息重新验证，否则可能无法进入游戏哦").show();init();
                        }else if(res.result.foreign_idcard_state == 3){  //审核成功
                            $(".oversea-success").show();
                        }else{
                            $(".oversea-writen").show();init();
                        }
                    }else{
                        $(".oversea-writen").show();init();
                    }
                } else {
                    alert(res.message);
                }
            //});
        }
        function init() {

            $(document).find('.u-tab li').bind('click',function(){
                var index = $(this).index();
                $(this).addClass("cur").siblings().removeClass("cur");
                $(document).find('.u-tab .tab-cont').eq(index).show().siblings().hide();
            })
            
            $.each([
                $(".u-form[name='a']")[0],
                $(".u-form[name='b']")[0]
            ],initForm);
        }
        var isFirstSumbit = true;
        function initForm(j,form) {
            var $form = $(form);
            var type = j+1;
            var $nameInput = $form.find("input[name=name]");
            var $idCardInput = $form.find("input[name=idcard]");
            var $fileField = $form.find('.file-field');
            var $fileInput = $form.find('input[type=file]');
            var $fileLayerError = $form.find(".file-layer-error");
            var $fileLayerReupload = $form.find('.file-layer-reupload');
            var $fileImg = $form.find(".file-img");
            var $submit = $form.find(".j-submit");
            var $error = $form.find(".invalid-feedback");
            

            $fileField.hover(function() {
                if($fileImg.attr("src")!=="" && !$fileLayerError.is(":visible")){
                    $fileLayerReupload.show()
                }
            },function(params) {
                $fileLayerReupload.hide()
            })
            
            
            $fileInput.change(function (e) {

                if($fileInput.val()=="") return false;
                
                $fileLayerError.hide();
                $fileImg.attr({ "src": "" });
                //$fileImg.css("filter","");
                
                if(imageFormatCheck(this)){
                    // $.ajaxFileUpload({
                    //     url:"ajaxUpload",
                    //     secureuri:false,
                    //     fileElementId:['fileField1'],
                    //     data: {},
                    //     dataType: 'json',
                    //     success: function (result){
                            var result = {
                                status : 1,
                                data : {
                                    src : "http://f.4399.com:8080/hw-realname/images/oversea_1.jpg"
                                }
                            }
                            if(result.status == 1 ){
                                $fileImg.attr({ "src": result.data.src }).show();
                            }
                    //     },
                    //     error:function(){
                    //         $error.html('文件上传失败！').show();
                    //     }
                    // });
                }else{
                    $fileInput.siblings(".file-layer").hide();
                    $fileInput.siblings(".file-layer-error").show();
                }
            });

            $submit.click(function() {
                var name    = $.trim($nameInput.val());
                var idcard  = $.trim($idCardInput.val());
                var placeholder = $idCardInput.attr("data-placeholder");
                var fileSrc  = $fileImg.attr("src");
                $error.hide()
                if(name=="" || name=="请输入你的姓名"){
                    $error.html("请输入你的姓名").show();
                    return false
                }
                if(idcard=="" || idcard==placeholder){
                    $error.html(placeholder).show();
                    return false
                }
                if(fileSrc==""){
                    $error.html("请上传真实的证件照片").show();
                    return false
                }
                
                console.log({
                    realname    : name,
                    idcard      : idcard,
                    type        : type
                });
                // $.ajax({
                //     url: '/ptlogin/editForeignRealname.do ',
                //     data: {
                //         realname    : name,
                //         idcard      : idcard,
                //         type        : type
                //     },
                //     dataType: 'json',
                //     type: 'POST',
                //     success: function (res) {
                        var res = {
                            status : 1,
                            
                        }
                        if (res.status) {
                            ue.dialog({
                                id: "j-confirm_popup",
                                content: $("#j-confirm-temp").html(),
                                lock: true,
                                force: true,
                                drag : true,
                                init: function () {
                                    var _pop = this,
                                        $pop = this.obj;

                                    $pop.find('.dialog-txt').html(
                                        isFirstSumbit ? 
                                        "信息进入审核阶段，在此期间您可正常使用产品功能，若审核未通过则需重新进行身份认证，回到原来的页面可继续进行相关操作"
                                        :
                                        "信息进入审核阶段，审核通过即可使用完整功能"
                                    )
                                    
                                    $pop.find('.j-confirm').bind("click",function(){
                                        _pop.close();
                                    });
                                }
                            });
                            isFirstSumbit = false;
                        }
                //     }
                // });
            })
        }

        $(function() {
            getIdcardState();
        })
    
    </script>
</body>
</html>
