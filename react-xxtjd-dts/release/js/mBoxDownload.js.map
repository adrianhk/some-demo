{"version":3,"sources":["mBoxDownload.js"],"names":["factory","define","exports","require","module","boxDownload","options","downAppInfo","downloadUrl","appInfo","downurl","packageName","packag","appname","iconPath","icopath","window","android","btn","downloadAPI","nbtn","document","querySelector","stateTxt","nStateTxt","strategies","status_200","innerHTML","handle","pauseDownload","JSON","stringify","status_102","status_101","downloadApp","installApp","launchApp","status_0","status_201","status_202","res","status","updateApps","updateApp"],"mappings":"oOAAA,SAAAA,GAMyB,mBAAXC,OACNA,OAAO,GAAGD,GAHE,YAATA,oBAATE,QAASF,YAAAA,QAATE,UACEF,EAAAG,QAAAD,QAAAE,QAIIJ,EAAQG,GAAAA,OAASD,QAASE,GAA1B,IATR,CAQU,SAIDD,EAAAD,EAAAE,GAEJ,SAAAC,EAAAC,GAEH,IAAAC,EAAkBL,CAIRM,YAAaC,QAAQC,QAF7BC,YAAqBL,QAArBM,OACQL,QAAAA,QAAcM,QACdL,SAAAA,QAAaC,QACbE,QAAAA,QAAaF,UAEbK,EAAUL,OAAQM,aAJJC,OAAAC,QAAlBC,EAAAZ,EAAAY,KAAA,cAOIC,EAAAA,EAAcH,UAAOG,gBAIrBC,EAAOC,SAASC,cAAcJ,GAF9BA,EAAMZ,SAAegB,cAAzBC,GAGIC,EAAAA,aAeAC,EAAa,CACbC,WAAY,WACRF,EAAUG,UAAY,SAD1BD,WAAY,WACRF,EAAAA,UAAUG,OAFDC,EAAA,WAAAT,EAAAU,cAAApB,QAAAG,UAKTQ,WAAKO,WACLC,EAAAA,UAAS,OAAWT,EAAAA,WAAYU,EAAcpB,YAA1BqB,KAAAC,UAAAxB,MACvByB,WAPY,WAQbC,EAAYN,UAAA,MAERC,WAAAA,WAAoBT,EAAAA,UAAYe,OAA0CN,EAA1E,WAAAT,EAAAgB,WAAA1B,QAAAG,UAEJoB,WAAY,WACRR,EAAAA,UAAUG,OAbDC,EAAA,WAAAT,EAAAiB,UAAA3B,QAAAG,UAgBTQ,WAAKO,WACLC,EAAAA,UAAS,OAAWT,EAAAA,WAAYgB,EAAW1B,YAAvBqB,KAAAC,UAAAxB,MACvB8B,SAlBY,WAmBbC,EAAAA,UAAY,OACRlB,EAAKO,WAAYR,EAAjBe,YAAAJ,KAAAC,UAAAxB,OAGJgC,OAAAA,WAAY,SAAAC,GACRpB,IAAAA,EAAKO,EAAAA,GAALc,QACS,KAATb,IAAoBT,EAAAA,UAAYe,QAEpCG,EAAU,UA3BGI,MA6BWtB,OAAAA,UAAAA,SAAYe,GAA0C,IAAAO,EAA1ED,EAAAC,OA7BRhB,EAAA,UA8BKgB,MAILzB,EAAO0B,aAAajC,QAAAG,OAAe,cAC/BO,EAAIsB,UAAS,WAAb,aAEIjB,EAAAA,iBAAUG,QAAY,WACzBC,MAKc,mBAAnBZ,GAAAA,SAAO2B,KAAPvC,GACIA,EAAAF,QAAasC,EAEbf,EAAAA,YAAWpB","file":"mBoxDownload.js","sourcesContent":["/*\r\n* 游戏盒下载游戏包模块\r\n*\r\n* */\r\n;(function(factory) {\r\n    // CMD/SeaJS\r\n    if(typeof define === \"function\") {\r\n        define([],factory);\r\n    }else if(typeof exports === 'object'){\r\n        factory(require, exports, module);\r\n    }\r\n    // No module loader\r\n    else {\r\n        factory('', window = window || {}, '');\r\n    }\r\n\r\n}(function(require, exports, module) {\r\n\r\n    function boxDownload(options){\r\n        var downAppInfo = {\r\n            downloadUrl: appInfo.downurl,\r\n            packageName: appInfo.packag,\r\n            appName: appInfo.appname,\r\n            iconPath: appInfo.icopath,\r\n            fileMD5: appInfo.md5_file\r\n        };\r\n        var downloadAPI = window.downloadAPI || window.android;\r\n\r\n        var btn = options.btn || \".j-download\";\r\n        var stateTxt = options.stateTxt || \".j-down-state\";\r\n        var nbtn = document.querySelector(btn);\r\n        var nStateTxt = document.querySelector(stateTxt);\r\n\r\n        var _status = null;\r\n        var handle = function(){};\r\n\r\n        /*runing（下载中） 100,\r\n         paused（暂停）101,\r\n         pending（等待）102,\r\n         success（下载成功） 103,\r\n         unpackpping（未安装） 200,\r\n         installed（已安装） 201,\r\n         cancel（取消） 0,\r\n         networkerror -100,\r\n         更新 202*/\r\n\r\n        var strategies = {\r\n            status_200: function () {\r\n                nStateTxt.innerHTML = '解压数据包';\r\n            },\r\n            status_100: function () {\r\n                nbtn.innerHTML = '暂停下载';\r\n                handle = function(){downloadAPI.pauseDownload(appInfo.packag);}\r\n            },\r\n            status_101: function () {\r\n                nbtn.innerHTML = '继续下载';\r\n                handle = function(){downloadAPI.downloadApp(JSON.stringify(downAppInfo));}\r\n            },\r\n            status_102: function () {\r\n                nStateTxt.innerHTML = '等待';\r\n            },\r\n            status_103: function () {\r\n                nbtn.innerHTML = '安装游戏';\r\n                handle = function(){downloadAPI.installApp(appInfo.packag);}\r\n            },\r\n            status_201: function () {\r\n                nbtn.innerHTML = '开始游戏';\r\n                handle = function(){downloadAPI.launchApp(appInfo.packag);}\r\n            },\r\n            status_202: function () {\r\n                nbtn.innerHTML = '更新游戏';\r\n                handle = function(){downloadAPI.downloadApp(JSON.stringify(downAppInfo));};\r\n            },\r\n            status_0: function () {\r\n                nbtn.innerHTML = '游戏下载';\r\n                handle = function(){downloadAPI.downloadApp(JSON.stringify(downAppInfo));};\r\n            }\r\n        };\r\n\r\n\r\n        window.updateApps = function (res) {\r\n            var status = res[0].status;\r\n            if (status == -100) {\r\n                nStateTxt.innerHTML = '网络错误';\r\n            }\r\n            _status = status;\r\n            strategies['status_' + status]();\r\n        };\r\n\r\n        window.updateApp = function (res) {\r\n            var status = res.status;\r\n            _status = status;\r\n            strategies['status_' + status]();\r\n        };\r\n        downloadAPI.getAppStatus(appInfo.packag,'updateApps');\r\n        downloadAPI.bindEvent(\"download\",\"updateApp\");\r\n\r\n        nbtn.addEventListener('click',function(){\r\n            handle();\r\n        });\r\n\r\n    }\r\n\r\n    if( {}.toString.call(module) == '[object Object]' ){\r\n        module.exports = boxDownload;\r\n    }else{\r\n        exports.boxDownload = boxDownload;\r\n    }\r\n\r\n}));\r\n\r\n"]}